<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2GETHER</title>
  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

  <!--AJAX-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <!--폰트어썸-->
  <script src="https://kit.fontawesome.com/2fb2def76d.js" crossorigin="anonymous"></script>
  <!--부트스트랩-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous" />
  <!--폰트-->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet" />
  <!--파비콘-->
  <link rel="icon" href="images/number2.png" type="image/png" />
  <!-- SweetAlert2 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.17.2/dist/sweetalert2.all.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.17.2/dist/sweetalert2.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: ivory;
    }

    .bold-style {
      font-weight: bold;
    }

    .highlight {
      position: relative;
    }

    .highlight:after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 40%;
      background-color: #fff20071;
      z-index: -1;
    }

    /* 스크롤바 */
    ::-webkit-scrollbar {
      width: 10px;
      /*스크롤바의 너비*/
    }

    ::-webkit-scrollbar-thumb {
      background-color: rgb(189, 189, 189);
      /*스크롤바의 색상*/
      border-radius: 10px;
      /*스크롤바 라운드*/
    }

    ::-webkit-scrollbar-thumb:hover {
      background-color: rgb(110, 110, 110);
    }

    ::-webkit-scrollbar-track {
      background-color: rgb(255, 255, 255);
      /*스크롤바 트랙 색상*/
      border-radius: 10px;
      /*스크롤바 트랙 라운드*/
      box-shadow: inset 0px 0px 5px rgba(0, 0, 0, 0.2);
      /*스크롤바 트랙 안쪽 그림자*/
    }

    /* Main Header 부분 CSS */
    .header-line {
      font-family: "Quicksand", sans-serif;
      color: rgb(231, 158, 0);
      font-weight: 700;
      height: 60px;
      display: flex;
      align-items: center;
      text-align: center;
      justify-content: space-around;
    }

    .heaer-logo>span {
      font-optical-sizing: auto;
      font-style: normal;
      font-size: x-large;
    }

    .header-etc>span {
      margin-left: 20px;
      margin-right: 20px;
      display: inline-block;
      /* 너비 설정 가능하게 */
      width: 130px;
      /* 적당한 고정 너비 (글자 길이에 따라 조절) */
      white-space: nowrap;
      /* 줄바꿈 방지 */
    }

    .main {
      font-family: "Quicksand", sans-serif;
      font-optical-sizing: auto;
      font-weight: 700;
      font-style: normal;
      height: 400px;
      color: aliceblue;

      background-image: url("images/twogetherMain.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;

      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .main-words {
      border-radius: 50px;
      margin-top: 50px;
      margin-bottom: 50px;
      background-color: rgba(41, 41, 41, 0.4);
      padding: 20px;
    }

    .main h1 {
      margin-bottom: 20px;
      letter-spacing: 10px;
    }

    .main p {
      margin-bottom: 3px;
    }

    /* 버튼 박스 부분 */
    .main-btn-box {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      text-align: center;
      gap: 10px;
      width: 870px;
      box-sizing: border-box;
    }

    .main-btn-box>button {
      width: 100px;
      padding: 10px 16px;
      background-color: rgba(255, 255, 255, 0);
      border: 0px;
      border-radius: 8px;

      font-family: "Quicksand", sans-serif;
      font-optical-sizing: auto;
      font-weight: 700;
      font-style: normal;
      font-size: large;
      color: rgb(73, 73, 73);

      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
    }

    /* 마우스 오버 시 */
    .main-btn-box>button:hover {
      background-color: rgba(255, 255, 255, 0.753);
      color: rgb(73, 73, 73);
      font-size: medium;
    }

    /* 클릭 시 */
    .main-btn-box>button:active {
      background-color: rgba(231, 158, 0, 0.4);
      color: rgb(0, 0, 0);
    }

    .mypostingbox {
      max-width: 600px;
      width: 90%;
      margin: 30px auto;
      background-color: #fffaf0;
      padding: 30px;
      border-radius: 25px;
      box-shadow: 0 6px 12px rgba(164, 113, 72, 0.15);
      /* 살짝 진한 브라운 계열 그림자 → 입체감 줌 */
      border: 2px solid #f3e4d7;
      transition: 0.3s ease-in-out;
      /* hover 등 상태 변화 시 부드럽게 애니메이션 */
    }

    .mypostingbox>button {
      width: 100%;
    }

    .mypostingbox:hover {
      /* hover : 사용자가 마우스를 올려놓았을 때"의 시각 효과를 설정하는 CSS 상태 선택자 */
      transform: scale(1.01);
      /*마우스 올렸을 때 살짝 커지는 효과 : 즉 마우스를 가져다가 대면 1.01배가 커지는 느낌*/
    }

    .form-floating {
      margin-bottom: 20px;
    }

    .form-control {
      border-radius: 12px;
      padding: 14px;
      background-color: #fff;
      box-shadow: inset 0 1px 3px rgba(231, 158, 0, 0.1);
      border: 1px solid #ccc;
    }

    #postingbtn {
      background-color: #a47148;
      color: white;
      border: none;
      padding: 14px 20px;
      border-radius: 15px;
      font-size: 17px;
      font-weight: bold;
      transition: 0.3s ease;
      /* 상태 변화 부드럽게 : 갑자기 툭! 하고 바뀌는게 아니라 0.3초 동안 천천히 변화*/
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    #postingbtn:hover {
      background-color: #7b5b3e;
      transform: translateY(-2px);
    }

    /* 팀원 조회 */
    .mySwiper {
      width: 100%;
      max-width: 1050px;
      margin: auto;
      position: relative;
      padding: 20px 40px;
      /*화살표 겹치지 않게 여백*/
      box-sizing: border-box;
    }

    /* 멤버 소개 */
    .mySwiper .member-select .member-title {
      color: rgb(123, 89, 45);
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: "Quicksand", sans-serif;
      font-style: normal;
      margin: 0 auto;
      font-size: 24px;
      font-weight: bold;
    }

    /* 프로필 정렬 */
    .mySwiper .swiper-slide {
      display: flex;
      justify-content: center;
    }

    /* 슬라이드 화살표 모양 설정 */
    .mySwiper .swiper-button-prev::after {
      content: "\f104";
      /* Font Awesome 아이콘 (예: fa-chevron-left) */
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
      font-size: 22px;
      color: #000;
    }

    .mySwiper .swiper-button-next::after {
      content: "\f105";
      /* Font Awesome 아이콘 (예: fa-chevron-right) */
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
      font-size: 22px;
      color: #000;
    }

    /* 마우스 올리면 아이콘으로 변경 */
    .mySwiper .swiper-button-prev:hover::after {
      content: "\f0a8";
      color: #007bff;
      font-size: 26px;
      transition: all 0.2s ease;
    }

    .mySwiper .swiper-button-next:hover::after {
      content: "\f0a9";
      /* hover 시 더 예쁜 아이콘으로 변경 */
      color: #007bff;
      font-size: 26px;
      transition: all 0.2s ease;
    }

    /* 프로필 카드 */
    .mySwiper .swiper-slide .card {
      width: 250px;
      height: 230px;
      margin-right: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border: none;
      border-radius: 8px;
      overflow: hidden;
      background-color: #f9f9f9;
      transition: all 0.35s ease;
      /*애니메이션 효과 주기*/
      transform: scale(1);
      /*크기를 1배 유지*/
    }

    /*card에 마우스를 올렸을 경우*/
    .mySwiper .swiper-slide .card:hover {
      transform: scale(1.05) translateY(-8px);
      /*크기 5% 확대, 위로 살짝 떠오르게*/
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.25);
      /*그림자를 이용해 부각되도록*/
      filter: brightness(1.05);
      /*밝기를 약간 높여서 강조*/
    }

    .mySwiper .card>img {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      object-fit: cover;
      margin: 20px auto 10px;
    }

    .card>.card-body {
      padding-top: 10px;
      margin: 0 auto;
      font-size: 20px;
      font-weight: bold;
    }

    .guestbook-container {
      width: 50%;
      margin: 50px auto;
      padding: 30px;
      border: 2px solid rgb(123, 89, 45);
      border-radius: 15px;
      background-color: rgb(244, 236, 220);
      color: black;
    }

    .guestbook-title {
      color: rgb(123, 89, 45);
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 25px;
      text-align: center;
      border-bottom: 1px solid black;
      padding-bottom: 15px;
    }

    .form-group {
      width: 90%;
      margin-bottom: 10px;
      margin-left: auto;
      margin-right: auto;
    }

    .form-group label {
      display: block;
      font-weight: bold;
      margin-bottom: 8px;
      color: rgb(123, 89, 45);
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 0px solid rgb(165, 165, 165);
      background-color: rgb(246, 242, 234);
      color: black;
      border-radius: 5px;
    }

    .btn-location {
      margin-left: 5%;
      width: 90%;
    }

    .btn-submit {
      width: 100px;
      padding: 12px;
      border: 1px solid white;
      background-color: rgb(123, 89, 45);
      color: white;
      border-radius: 5px;
      cursor: pointer;
      text-align: center;
      transition: all 0.3s ease;
      margin-left: auto;
    }

    .btn-submit:hover {
      background-color: black;
      color: white;
      border-bottom: red;
    }

    .commentBox {
      width: 90%;
      margin-top: 40px;
      border-radius: 5px;
      margin-left: auto;
      margin-right: auto;
      padding: 0;
      display: grid;
      grid-template-columns: 80px 1fr;
      align-items: center;
      border: 0px solid rgb(165, 165, 165);
      background-color: rgb(246, 242, 234);
      border-radius: 15px;
    }

    .commentProfile {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 20px;
    }

    .commentContents {
      margin-top: 5px;
      margin-left: 20px;
    }

    .commentProfile>.fa-solid {
      font-size: 50px;
    }

    .contentBox {
      font-size: 80%;
      margin-right: 7%;
    }

    .time {
      font-size: small;
      color: gray;
    }

    .pagination {
      margin-top: 5%;
      display: flex;
      justify-content: center;
    }

    .page-link {
      color: rgb(123, 89, 45);
    }

    .count {
      font-weight: bold;
      color: rgb(123, 89, 45);
    }

    .about-us-ment {
      color: rgb(123, 89, 45);
      margin: 30px auto 30px auto;
      width: 700px;
      border-bottom: 1px solid rgb(123, 89, 45);
      height: 70px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .about-us-ment>span {
      font-family: "Quicksand", sans-serif;
      font-style: normal;
      margin: 0 auto;
      font-size: 24px;
      font-weight: bold;
    }

    .about-us {
      color: rgb(123, 89, 45);
      margin: 0 auto 50px auto;
      width: 800px;
      height: 900px;
      display: flex;
      flex-wrap: wrap;
      align-content: flex-start;
    }

    .about-us>article {
      height: 300px;
      font-size: 24px;
      font-family: "Quicksand", sans-serif;
      font-style: normal;
      font-weight: bold;
      box-sizing: border-box;
    }

    .art1,
    .art5 {
      width: 30%;
      padding: 60px 0px 60px 60px;
    }

    .art4 {
      width: 30%;
      padding: 60px 60px 60px 0px;
    }

    .about-us img {
      width: 120%;
      height: 100%;
      object-fit: cover;
    }

    .art2,
    .art3,
    .art6 {
      width: 70%;
      padding-bottom: 20px;
      display: grid;
      grid-template-rows: 1fr 2fr;
    }

    .us-title {
      margin: 0 200px;
      border-bottom: 1px solid rgb(123, 89, 45);
      display: flex;
      justify-content: center;
      align-items: center;

      font-family: "Quicksand", sans-serif;
      font-style: normal;
      font-weight: 600;
      font-size: 30px;
      line-height: 80px;
      text-align: center;
    }

    .us-content {
      padding-top: 30px;
      display: flex;
      flex-direction: column;
      justify-content: baseline;

      font-family: "Quicksand", sans-serif;
      font-style: normal;
      font-weight: 400;
      font-size: 20px;
      line-height: 30px;
      text-align: center;
    }

    .us-content p {
      margin: 5px;
    }

    footer {
      position: relative;
      width: auto;
      height: 55px;
      bottom: 0%;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #7b5b3e;
      font-size: 13px;
      border-top: 1px solid #7b5b3e;
    }
  </style>

  <script type="module">
    // Firebase SDK 라이브러리 가져오기
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import {
      collection,
      addDoc,
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import {
      query,
      where,
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import { serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"; // serverTimestamp import 추가
    import {
      doc,
      getDoc,
      setDoc,
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"; // 방문자 수 관련 추가

    // Firebase 구성 정보 설정
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyCVPjHmumz5vE8GeGMFX9Z1Kgkc6Br9tpM",
      authDomain: "sparta-ec005.firebaseapp.com",
      projectId: "sparta-ec005",
      storageBucket: "sparta-ec005.firebasestorage.app",
      messagingSenderId: "164807435795",
      appId: "1:164807435795:web:cf27e6ffe27d5bc05901e6",
    };

    // Firebase 인스턴스 초기화
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    $("#postingbtn").click(async function () {
      let image = $("#imageUrl").val().trim();
      let name = $("#name").val().trim();
      let birth = $("#birth").val().trim();
      let blogLink = $("#blogLink").val().trim();
      let hobby = $("#hobby").val().trim();
      let intro = $("#intro").val().trim();
      let tmi = $("#tmi").val().trim();

      // 이미지 URL이 유효한지 확인하는 함수
      function isValidImageUrl(url) {
        // URL이 'http'로 시작하고, 끝이 .jpg / .jpeg / .png / .gif / .webp 중 하나인지 확인
        return (
          url.startsWith("http") && /\.(jpg|jpeg|png|gif|webp)$/.test(url)
        );
        /*
  startsWith("http") → 인터넷 주소 형식인지 확인
  /\.(...)\$/ → 해당 확장자로 "끝나는지" 정규표현식으로 검사
  */
      }

      // 블로그 링크가 유효한지 확인하는 함수
      function isValidLink(url) {
        // URL이 http:// 또는 https:// 로 시작하는지 확인
        return url.startsWith("http://") || url.startsWith("https://");
        /*
  startsWith → 문자열이 지정한 부분으로 시작하는지 검사
  두 가지 조건 중 하나라도 만족하면 true
  */
      }

      function isValidBirth(birth) {
        const inputDate = new Date(birth);
        const today = new Date();
        return birth && inputDate <= today;
      }

      if (
        !image ||
        !name ||
        !birth ||
        !blogLink ||
        !hobby ||
        !intro ||
        !tmi
      ) {
        Swal.fire({
          icon: "warning",
          title: "입력 오류",
          text: "모든 항목을 빠짐없이 입력해주세요!",
          confirmButtonColor: "#A47148",
        });
        return;
      }

      // 개별 필드 유효성 검사
      if (!isValidImageUrl(image)) {
        return Swal.fire({
          icon: "error",
          title: "이미지 주소 오류",
          text: "이미지 URL이 올바른 형식이 아닙니다. (jpg, png 등)",
          confirmButtonColor: "#A47148",
        });
      }

      if (!isValidLink(blogLink)) {
        return Swal.fire({
          icon: "error",
          title: "블로그 링크 오류",
          text: "블로그 주소는 http 또는 https로 시작해야 합니다.",
          confirmButtonColor: "#A47148",
        });
      }

      if (!isValidBirth(birth)) {
        return Swal.fire({
          icon: "error",
          title: "생년월일 오류",
          text: "생년월일은 오늘보다 이전 날짜여야 합니다.",
          confirmButtonColor: "#A47148",
        });
      }

      // 확인창 띄우기(저장, 취소)
      const result = await Swal.fire({
        title: "정말 팀원을 추가하시겠습니까?",
        text: "입력한 정보가 저장됩니다.",
        icon: "question",
        showCancelButton: true,
        confirmButtonColor: "#A47148",
        cancelButtonColor: "#999",
        confirmButtonText: "추가하기",
        cancelButtonText: "취소",
      });

      // if문을 사용자가 "추가하기"를 눌렀을 때만 저장
      if (result.isConfirmed) {
        let doc = {
          image: image,
          name: name,
          birth: birth,
          blogLink: blogLink,
          hobby: hobby,
          intro: intro,
          tmi: tmi,
        };

        await addDoc(collection(db, "Intro"), doc);

        await Swal.fire({
          icon: "success",
          title: "저장 완료!",
          text: "팀원이 성공적으로 추가되었습니다.",
          confirmButtonColor: "#A47148",
        });

        window.location.reload();
      } else {
        // 사용자가 "취소"를 눌렀을 때
        Swal.fire({
          icon: "info",
          title: "취소됨",
          text: "팀원 추가가 취소되었습니다.",
          confirmButtonColor: "#A47148",
        });
      }
    });

    // 팀원 추가
    $("#savebtn").click(async function () {
      $("#postingbox").slideToggle();
      $(".mySwiper").slideUp();
    });

    //   팀원 조회
    $("#selectbtn").click(async function () {
      $(".mySwiper").slideToggle();
      $("#postingbox").slideUp();
    });

    // 팀원 추가할 경우 프로필 생성
    let docs = await getDocs(collection(db, "Intro"));
    docs.forEach((doc) => {
      let row = doc.data();
      let docId = doc.id; //문서 ID 가져오기
      let image = row["image"];
      let name = row["name"];

      let temp_html = `
            <div class = "swiper-slide">
              <div class="card" style="cursor:pointer" onclick="location.href='2getherDetailPage.html?id=${docId}'">
                  <img src="${image}" class="card-img-top" alt="profile img" />
                  <div class="card-body">
                      <p class="card-text">${name}</p>
                  </div>
              </div>
            </div>`;
      $("#profile").append(temp_html);
    });

    // 슬라이드 동작 (초기화)
    const swiper = new Swiper(".mySwiper", {
      slidesPerView: 3, // 한 화면에 보일 카드 개수
      spaceBetween: 30, // 카드 간 간격(px)
      navigation: {
        nextEl: ".swiper-button-next", // 다음 버튼 클래스
        prevEl: ".swiper-button-prev", // 이전 버튼 클래스
      },
    });

    // 방명록 등록 기능
    let guestbookData = [];
    let pageNum = 1;

    // 방명록 등록 기능
    $("#guestSubmit").click(async function () {
      let name = $("#guestName").val();
      let content = $("#guestContent").val().replace(/\n/g, " ");

      if (name.trim() === "" || content.trim() === "") {
        Swal.fire({
          title: "입력값이 이상해요",
          text: "이름과 내용을 똑바로좀 적어주세요",
          icon: "warning",
        });
        return;
      }

      let doc = {
        name: name,
        content: content,
        timestamp: serverTimestamp(),
      };

      await Swal.fire({
        title: "등록할래요?",
        icon: "question",
        showCancelButton: true,
        confirmButtonText: "등록해요",
        cancelButtonText: "다시할래요",
      }).then(async (result) => {
        if (result.isConfirmed) {
          await addDoc(collection(db, "guestbook"), doc);
          Swal.fire("등록했어요!", "", "success");
          $("#guestName").val("");
          $("#guestContent").val("");
          getGuestbookCount(); //방명록 개수 세기
          getGuestbook(); // 데이터를 다시 불러오기
        }
      });
    });

    // 방명록 개수
    async function getGuestbookCount() {
      const querySnapshot = await getDocs(collection(db, "guestbook"));
      const count = querySnapshot.size; // 컬렉션의 문서 수를 가져옴
      $("#message").text(count); // 방명록 수 표시
    }

    // 방명록 데베에서 로드
    async function getGuestbook() {
      const querySnapshot = await getDocs(collection(db, "guestbook"));
      guestbookData = [];

      querySnapshot.forEach((doc) => {
        let data = doc.data();
        guestbookData.push({
          ...data,
          // i: doc.id, // 문서 ID도 함께 저장
        });
      });
      // timestamp 기준으로 내림차순 정렬
      guestbookData.sort((a, b) => b.timestamp.seconds - a.timestamp.seconds); // 서버 timestamp 비교

      displayGuestbookData();
      pagination_add(); // 페이지네이션 추가
    }

    // 방명록 프로필 컬러 설정
    function randomRgb() {
      let r = Math.floor(Math.random() * 256);
      let g = Math.floor(Math.random() * 256);
      let b = Math.floor(Math.random() * 256);
      return `rgb(${r}, ${g}, ${b})`;
    }

    // 방명록 출력
    function displayGuestbookData() {
      let commentList = guestbookData.slice((pageNum - 1) * 5, pageNum * 5);
      $("#guestList .commentBox").remove(); // 기존의 방명록 없애기_다시 출력할꺼니까

      let html = "";
      commentList.forEach((data) => {
        let rgb = randomRgb();
        html += `
                    <div class="commentBox">
                      <div class = "commentProfile">
                        <i class="fa-solid fa-circle-user" style = "color:${rgb}"></i>
                      </div>
                      <div class = "commentContents">
                        <strong>${data.name}</strong><br/>
                        <p class = "contentBox">${data.content}</p>
                        <p class="time">${data.timestamp
            .toDate()
            .toLocaleString()}</p>
                      </div>
                    </div>
                `;
      });
      $("#guestList").append(html);
    }

    // 페이지네이션 추가
    function pagination_add() {
      const pages = Math.ceil(guestbookData.length / 5);
      let html = "";

      // 페이지네이션 버튼 추가
      for (let i = 0; i < pages; i++) {
        html += `
                    <li class="page-item">
                        <a class="page-link" href="#">${i + 1}</a>
                    </li>
                `;
      }

      $(".pagination").html(html); // 페이지네이션을 추가
    }

    // 페이지네이션 버튼 클릭, 방명록 출력
    $(document).on("click", ".page-link", function (event) {
      event.preventDefault();
      pageNum = parseInt($(this).text()); // 클릭한 페이지 번호
      displayGuestbookData(); // 해당 페이지의 방명록 출력
    });

    $(document).ready(function () {
      // 데베 로드
      getGuestbook();

      // 개수 카운트
      getGuestbookCount();
    });

    //---------------------------------------------------------------------------------------

    // 일정 시간마다 방문자 수 증가
    setInterval(() => {
      // 일정 시간마다 실행할 함수
      updateVisitorCount(); // 방문자 수 증가 로직
    }, 1000 * 10); // n초마다 실행

    // 방문자 수 올라갈때 애니메이션 추가
    function animateCountUp(element, start, end, duration = 2000) {
      const range = end - start;
      const startTime = performance.now();

      function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const currentValue = Math.floor(start + range * progress);

        element.textContent = `방문자 수 : ${currentValue}`;

        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }

      requestAnimationFrame(update);
    }

    let firstVisit = true;

    // 방문자 수 불러오고 +1 업데이트
    async function updateVisitorCount() {
      try {
        // 문서 참조
        const visitRef = doc(db, "siteCount", "visitCount");
        const snapshot = await getDoc(visitRef);
        const randomCount = Math.floor(Math.random() * 5) + 1;

        let countAll = 0;

        // 데이터 읽기
        if (snapshot.exists()) {
          countAll = snapshot.data().countAll || 0;
        }

        if (countAll > 1000) {
          countAll = 0;
        }

        if (firstVisit) {
          countAll += 1;
          firstVisit = false;
        } else {
          countAll += randomCount;
        }

        // 데이터 업데이트
        await setDoc(visitRef, { countAll });

        // span 태그 내의 문자열 가져와서 숫자 값만 남김
        const header_count = document.getElementById("header_count");
        const currentDisplay =
          parseInt(header_count.textContent.replace(/\D/g, "")) || 0;

        // 방문자 수 올라갈때 애니메이션 추가
        animateCountUp(header_count, currentDisplay, countAll);
      } catch (error) {
        console.error("방문자 수 업데이트 실패:", error);
      }
    }

    // 방문자 함수 실행
    updateVisitorCount();

    //---------------------------------------------------------------------------------------

    // 날씨 관련
    // 좌표 설정 (서울 종로구 기준: nx=60, ny=127)
    let nx, ny;
    //현재 위치값 가져오는 API
    navigator.geolocation.getCurrentPosition(success, error);

    function success(position) {
      // 실제 포지션 값
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;

      // 기상청 API에 적용할 수 있게 가공
      const result = dfs_xy_conv(lat, lon);
      nx = result.nx;
      ny = result.ny;

      // 임의의 좌표 생성시 사용
      //nx = 20;
      //ny = 127;
      console.log("현재 격자 좌표:", nx, ny);

      getWeather(nx, ny);
    }

    function error(err) {
      console.error("위치 정보를 가져올 수 없습니다:", err.message);
    }

    // 위도,경도를 기상청API에 사용하도록 가공 (기상청 공식 함수)
    function dfs_xy_conv(lat, lon) {
      const RE = 6371.00877; // 지구 반지름(km)
      const GRID = 5.0; // 격자 간격(km)
      const SLAT1 = 30.0;
      const SLAT2 = 60.0;
      const OLON = 126.0;
      const OLAT = 38.0;
      const XO = 43;
      const YO = 136;

      const DEGRAD = Math.PI / 180.0;
      const re = RE / GRID;
      const slat1 = SLAT1 * DEGRAD;
      const slat2 = SLAT2 * DEGRAD;
      const olon = OLON * DEGRAD;
      const olat = OLAT * DEGRAD;

      let sn =
        Math.tan(Math.PI * 0.25 + slat2 * 0.5) /
        Math.tan(Math.PI * 0.25 + slat1 * 0.5);
      sn = Math.log(Math.cos(slat1) / Math.cos(slat2)) / Math.log(sn);

      let sf = Math.tan(Math.PI * 0.25 + slat1 * 0.5);
      sf = (Math.pow(sf, sn) * Math.cos(slat1)) / sn;

      let ro = Math.tan(Math.PI * 0.25 + olat * 0.5);
      ro = (re * sf) / Math.pow(ro, sn);

      const ra = Math.tan(Math.PI * 0.25 + lat * DEGRAD * 0.5);
      const r = (re * sf) / Math.pow(ra, sn);

      let theta = lon * DEGRAD - olon;
      if (theta > Math.PI) theta -= 2.0 * Math.PI;
      if (theta < -Math.PI) theta += 2.0 * Math.PI;
      theta *= sn;

      const x = Math.floor(r * Math.sin(theta) + XO + 0.5);
      const y = Math.floor(ro - r * Math.cos(theta) + YO + 0.5);

      return { nx: x, ny: y };
    }

    // 현재 시간 기준으로 기상청 기준 날짜 가져오는 함수
    function getBaseTime(hour) {
      const times = [2, 5, 8, 11, 14, 17, 20, 23]; // 기상청 지원 base 시간
      let baseHour = 23; // 기본값 (가장 늦은 시간)

      for (let i = 0; i < times.length; i++) {
        if (hour < times[i]) {
          baseHour = times[i - 1] ?? 23; // 제일 이른 시간 전이면 23시 (전날)
          break;
        }
      }

      return String(baseHour).padStart(2, "0") + "00"; // ex) 0200, 0500, 0800
    }

    // 날씨 정도 가져오는 함수
    function getWeather(nx, ny) {
      console.log("지금 나의 위치 :: " + nx + ny);

      // 오늘 날짜와 적절한 base_time 계산
      const now = new Date();
      const base_date = now.toISOString().slice(0, 10).replace(/-/g, "");
      const hour = now.getHours();
      const nowHourBase = String(hour + 1).padStart(2, '0') + '00';
      const base_time = getBaseTime(hour); //3시간 단위 (0500, 0800 ...)

      console.log("현재시간 ::: " + nowHourBase);

      // 날씨 API 에서 인코딩된 키 사용
      const serviceKey =
        "B%2FPWusMdlDVh0QO2vrTiYOKte6sWDCN5MD9FQR5LPquOyR53Usl%2F%2Fb%2FN3zToN%2BFGYDl2lY6BJos%2F7NOVbWD%2ByA%3D%3D";

      const url = `https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst?serviceKey=${serviceKey}&pageNo=1&numOfRows=36&dataType=JSON&base_date=${base_date}&base_time=${base_time}&nx=${nx}&ny=${ny}`;

      console.log(url);

      const weatherinfo = document.getElementById("header_whether");
      fetch(url)
        .then((response) => {
          if (!response.ok) {
            throw new Error("네트워크 응답에 문제가 있습니다.");
          }
          return response.json();
        })
        .then((data) => {
          const items = data.response.body.items.item;

          // 예보 시간 기준으로 정렬 (선택 사항)
          const forecast = {};
          forecast[nowHourBase] = {};

          items.forEach((item) => {
            if (item.fcstTime === nowHourBase) {
              if (item.category === "TMP") {
                forecast[nowHourBase].temp = item.fcstValue;
              } else if (item.category === "SKY") {
                forecast[nowHourBase].sky = item.fcstValue;
              } else if (item.category === "PTY") {
                forecast[nowHourBase].pty = item.fcstValue;
              }
            }
          });

          console.log(forecast);


          const currentForecast = forecast[nowHourBase];

          // 상태 매핑 (FontAwesome 아이콘 사용)
          const skyMap = {
            1: "fas fa-sun", // 맑음
            3: "fas fa-cloud-sun", // 흐림
            4: "fa-solid fa-smog", // 구름
          };
          const ptyMap = {
            0: "없음",
            1: "fa-solid fa-umbrella", // 비
            2: "fa-solid fa-cloud-meatball", // 비/눈
            3: "fa-solid fa-snowflake", // 눈
            4: "fa-solid fa-cloud-showers-heavy", // 소나기
            5: "fa-solid fa-cloud-rain", // 비
            6: "fa-solid fa-cloud-meatball", // 함박눈
            7: "fa-solid fa-cloud-meatball", // 함박눈
          };

          // 전체 예보 시간 중 첫 번째 항목만 선택
          const tmp = currentForecast.temp;

          let status = null;

          if (currentForecast.pty == 0) {
            status = skyMap[currentForecast.sky];
          } else {
            status = ptyMap[currentForecast.pty];
          }

          console.log(`[${nowHourBase}] 기온: ${tmp}°C / 상태: ${status}`);
          let whetherTag = `<i class="${status}"></i> &nbsp; ${tmp}°C`;
          weatherinfo.innerHTML = whetherTag;
        })
        .catch((error) => {
          console.error("날씨 정보를 가져오는 데 실패했습니다:", error);
        });
    }

    // 버튼1 애니메이션
    const savebtn = document.getElementById("savebtn");

    const originalText = `<i class="fa-solid fa-user-plus"></i>`;
    const hoverText = "멤버추가";

    savebtn.addEventListener("mouseover", () => {
      savebtn.innerHTML = hoverText;
    });

    savebtn.addEventListener("mouseout", () => {
      savebtn.innerHTML = originalText;
    });

    // 버튼2 애니메이션
    const selectbtn = document.getElementById("selectbtn");

    const originalText2 = `<i class="fa-solid fa-people-group"></i>`;
    const hoverText2 = "멤버조회";

    selectbtn.addEventListener("mouseover", () => {
      selectbtn.innerHTML = hoverText2;
    });

    selectbtn.addEventListener("mouseout", () => {
      selectbtn.innerHTML = originalText2;
    });
  </script>
</head>

<body>
  <div class="header-line">
    <div class="heaer-logo">
      <span><i class="fa-solid fa-2"></i></span>
      <span>GETHER</span>
    </div>
    <div class="header-etc">
      <span id="header_whether">날이 적당해요...</span>
      <span id="header_count">방문자 수 : </span>
    </div>
  </div>
  <div class="main">
    <div class="main-words">
      <h1 class="display-2 fw-bold"><i class="fa-solid fa-2"></i>GETHER</h1>
      <p class="fs-4 mx-auto">
        공부도 과제도 고민도 함께하는 2조 2Gether입니다.
      </p>
      <p class="fs-5 mx-auto">
        각기 다른 개성과 능력을 가진 팀원들이 하나의 목표를 향해 함께
        나아간다는 의미를 담고 있습니다.
      </p>
    </div>
    <div class="main-btn-box">
      <button id="savebtn" type="button">
        <i class="fa-solid fa-user-plus"></i>
      </button>
      <button id="selectbtn" type="button">
        <i class="fa-solid fa-people-group"></i>
      </button>
    </div>
  </div>

  <!-- 팀원 추가 -->
  <div class="mypostingbox" id="postingbox" style="display: none">
    <div style="
          text-align: center;
          font-size: 24px;
          font-weight: bold;
          color: #a47148;
          margin-bottom: 20px;
        ">
      자신을 소개해보세요 💬
    </div>
    <div class="form-floating mb-3">
      <input type="email" class="form-control" id="imageUrl" placeholder="본인 이미지 주소" />
      <label for="floatingInput">이미지</label>
    </div>
    <div class="form-floating mb-3">
      <input type="email" class="form-control" id="name" placeholder="이름" />
      <label for="floatingInput">이름</label>
    </div>
    <div class="form-floating mb-3">
      <input type="date" class="form-control" id="birth" placeholder="생년월일" />
      <label for="birth">생년월일</label>
    </div>
    <div class="form-floating mb-3">
      <input type="email" class="form-control" id="blogLink" placeholder="블로그 링크" />
      <label for="floatingInput">블로그 링크</label>
    </div>
    <div class="form-floating mb-3">
      <input type="email" class="form-control" id="hobby" placeholder="취미" />
      <label for="floatingInput">취미</label>
    </div>
    <div class="form-floating mb-3">
      <input type="email" class="form-control" id="intro" placeholder="한 줄 자기소개" />
      <label for="floatingInput">한 줄 자기소개</label>
    </div>
    <div class="form-floating mb-3">
      <input type="email" class="form-control" id="tmi" placeholder="TMI" />
      <label for="floatingInput">TMI</label>
    </div>
    <button id="postingbtn" type="button">
      <i class="fa-solid fa-plus"></i>팀원 추가하기
    </button>
  </div>

  <!-- 팀원 조회 -->
  <div class="swiper mySwiper mt-3" style="display: none">
    <div class="member-select mb-3">
      <h3 class="member-title">멤버 소개</h3>
    </div>
    <div class="swiper-wrapper" id="profile"></div>

    <!-- 슬라이드 화살표 -->
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
  </div>

  <!-- 팀 규칙 -->
  <div class="about-us-ment"><span>팀 소개</span></div>
  <div class="about-us">
    <article class="art1">
      <img src="images/chickenBaby1.png" alt="" />
    </article>
    <article class="art2">
      <div class="us-title"><i class="fa-solid fa-2"></i> GETHER</div>
      <div class="us-content">
        <!--
        <p>여기에는</p>
        <p>우리에대한</p>
        <p>내용을적어요</p>
        -->
        <p>
          저희...이제 막 병아리가 됐는데<br />
          뭘 해야하죠? 웹페이지 만들어야죠.<br />
          생존하기 위해 6명이 모였습니다.<br />
          6마리의 병아리 모임<br />
          팀 <span class="bold-style">2gether</span>입니다.<br />
        </p>
      </div>
    </article>
    <article class="art3">
      <div class="us-title">팀 규칙</div>
      <div class="us-content">
        <!--        
        <p>여기에는</p>
        <p>우리의</p>
        <p>규칙을적어요</p>
        -->
        <p>
          <span class="bold-style">1. </span><span class="highlight">시간 약속을</span> 엄수해요<br /><br />
          <span class="bold-style">2. </span><span class="highlight">부드러운 표현을</span> 사용해요<br /><br />
          <span class="bold-style">3. </span><span class="highlight">적극적으로</span> 참여해요<br />
        </p>
      </div>
    </article>
    <article class="art4">
      <img src="images/chickenBaby2.png" alt="" />
    </article>
    <article class="art5">
      <img src="images/chickenBaby3.png" alt="" />
    </article>
    <article class="art6">
      <div class="us-title">우리 시간표</div>
      <div class="us-content">
        <!--
        <p>여기에는</p>
        <p>우리가 시간을</p>
        <p>보내는 방법을 적어요</p>
        -->
        <p>
          09:00 ~ 12:00: 파트 작업<br />
          12:00 ~ 13:00: 점심 시간<br />
          13:00 ~ 18:00: 병합, 수정<br />
          18:00 ~ 19:00: 저녁 시간<br />
          19:00 ~ 20:00: 최종 점검<br />
          20:00 ~ 21:00: TIL 작성<br />
        </p>
      </div>
    </article>
  </div>

  <div class="guestbook-container">
    <div class="guestbook-title">방명록</div>

    <div class="form-group">
      <label for="guestName">이름</label>
      <input type="text" id="guestName" placeholder="이름을 입력하세요" />
    </div>
    <div class="form-group">
      <label for="guestContent">방명록 내용</label>
      <textarea id="guestContent" rows="3" placeholder="내용을 입력하세요" wrap="off"></textarea>
    </div>
    <div class="btn-location">
      <div class="btn-submit" id="guestSubmit">등록하기</div>
    </div>
    <hr />
    <div class="count">
      <p>방명록 수: <span id="message">?</span></p>
    </div>
    <div id="guestList" style="margin-top: 30px"></div>

    <div class="pagination-location">
      <nav aria-label="Page navigation example">
        <ul class="pagination"></ul>
      </nav>
    </div>
  </div>
  <footer>
    <span>
      Company Info | Terms of Service | Privacy Policy | CS | Business
      Registration Number 123-12-12345 | CEO Earth | 161 Sajik-ro, Jongno-gu,
      Seoul, Republic of Korea | Tel 0505-1212-3434
    </span>
  </footer>
</body>

</html>