<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2GETHER</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous" />
    <style>
        .main {
            color: black;

            background-position: center;
            background-size: cover;

            background-color: white;
            /* ë°°ê²½ì„ í°ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .mypostingbox>button {
            width: 100%;
        }

        .mypostingbox {
            width: 500px;
            margin: 20px auto 20px auto;

            border: 1px solid white;
            padding: 20px;
            border-radius: 5px;
        }

        #profile {
            display: flex;
            justify-content: center;
        }

        .card {
            width: 250px;
            height: 200px;
            margin-right: 10px;
        }

        .card>img {
            width: 100px;
            height: 100px;
            margin: 20px auto;
        }

        .card>.card-body {
            margin: 0 auto;
        }

        .guestbook-container {
            width: 100%;
            margin: 50px auto;
            padding: 30px;
            border: 2px solid black;
            border-radius: 15px;
            background-color: white;
            color: black;
        }

        .guestbook-title {
            font-size: 28px;
            margin-bottom: 25px;
            text-align: center;
            border-bottom: 1px solid black;
            padding-bottom: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: black;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #444;
            background-color: white;
            color: black;
            border-radius: 5px;
        }

        .btn-submit {
            width: 100%;
            padding: 12px;
            border: 1px solid black;
            background-color: transparent;
            color: black;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .btn-submit:hover {
            background-color: black;
            color: white;
        }
    </style>

    <script type="module">
        // Firebase SDK ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";


        // Firebase êµ¬ì„± ì •ë³´ ì„¤ì •
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyBpjDN7BhiyNBfu5a_2lHS88_YRqLKuG-w",
            authDomain: "sparta-e1dce.firebaseapp.com",
            projectId: "sparta-e1dce",
            storageBucket: "sparta-e1dce.firebasestorage.app",
            messagingSenderId: "1037901267217",
            appId: "1:1037901267217:web:b90b85f7c24c74ef530cb0",
            measurementId: "G-MYLSSH91WS"
        };


        // Firebase ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        $("#postingbtn").click(async function () {
            let image = $('#imageUrl').val();
            let name = $('#name').val();
            let age = $('#age').val();
            let blogLink = $('#blogLink').val();
            let hobby = $('#hobby').val();
            let intro = $('#intro').val();
            let tmi = $('#tmi').val();

            let doc = {
                'image': image,
                'name': name,
                'age': age,
                'blogLink': blogLink,
                'hobby': hobby,
                'intro': intro,
                'tmi': tmi
            };
            await addDoc(collection(db, "Intro"), doc);
            alert('ì €ì¥ ì™„ë£Œ!');
            window.location.reload();
        })

        // íŒ€ì› ì¶”ê°€
        $("#savebtn").click(async function () {
            $("#postingbox").toggle();
            $("#profile").hide();
        });

        //   íŒ€ì› ì¡°íšŒ
        $("#selectbtn").click(async function () {
            $("#profile").toggle();
            $("#postingbox").hide();
        });

        let docs = await getDocs(collection(db, "Intro"));
        docs.forEach((doc) => {
            let row = doc.data();
            let docId = doc.id; // ğŸ”¥ ë¬¸ì„œ ID ê°€ì ¸ì˜¤ê¸°
            let image = row['image'];
            let name = row['name'];

            let temp_html = `
            <div class="card" style="cursor:pointer" onclick="location.href='2getherDetailPage.html?id=${docId}'">
                <img src="${image}" class="card-img-top" alt="profile img" />
                <div class="card-body">
                    <p class="card-text">${name}</p>
                </div>
            </div>`;
            $('#profile').append(temp_html);
        });


        // ë°©ëª…ë¡ ë“±ë¡ ê¸°ëŠ¥
        $("#guestSubmit").click(async function () {
            let name = $("#guestName").val();
            let content = $("#guestContent").val();

            if (name.trim() === "" || content.trim() === "") {
                alert("ì´ë¦„ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            let doc = {
                name: name,
                content: content,
            };

            await addDoc(collection(db, "guestbook"), doc);
            alert("ë°©ëª…ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
            $("#guestName").val("");
            $("#guestContent").val("");

            getGuestbook(); // ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
        });

        async function getGuestbook() {
            const querySnapshot = await getDocs(collection(db, "guestbook"));

            let html = "";
            querySnapshot.forEach((doc) => {
                let data = doc.data();
                html += `
        <div style="border-top: 1px solid #ccc; padding: 15px 0;">
            <strong>${data.name}</strong><br/>
            <p>${data.content}</p>
        </div>
        `;
            });

            // ì¶œë ¥ ìœ„ì¹˜ê°€ í•„ìš”í•˜ë¯€ë¡œ guestbook-container ì•„ë˜ì— div ì¶”ê°€í•´ì•¼ í•¨
            $("#guestList").html(html);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°©ëª…ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        getGuestbook();
    </script>
</head>

<body>
    <div class="main">
        <div class="p-5 mb-4 bg-body-tertiary rounded-3">
            <div class="container-fluid py-5">
                <h1 class="display-5 fw-bold">2GETHER</h1>
                <p class="col-md-8 fs-4 mx-auto">
                    ê³µë¶€ë„ ê³¼ì œë„ ê³ ë¯¼ë„ í•¨ê»˜í•˜ëŠ” 2ì¡° 2getherì…ë‹ˆë‹¤. ê°ê¸° ë‹¤ë¥¸ ê°œì„±ê³¼
                    ëŠ¥ë ¥ì„ ê°€ì§„ íŒ€ì›ë“¤ì´ í•˜ë‚˜ì˜ ëª©í‘œë¥¼ í–¥í•´ ë‚˜ì•„ê°„ë‹¤ëŠ” ì˜ë¯¸ë¥¼ ë‹´ê³ 
                    ìˆìŠµë‹ˆë‹¤.
                </p>
                <button id="savebtn" type="button" class="btn btn-outline-dark">
                    íŒ€ì› ì¶”ê°€
                </button>
                <button id="selectbtn" type="button" class="btn btn-outline-dark">
                    íŒ€ì› ì¡°íšŒ
                </button>
            </div>
        </div>
    </div>

    <!-- íŒ€ì› ì¶”ê°€ -->
    <div class="mypostingbox" id="postingbox">
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="imageUrl" placeholder="ë³¸ì¸ ì´ë¯¸ì§€ ì£¼ì†Œ" />
            <label for="floatingInput">ì´ë¯¸ì§€</label>
        </div>
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="name" placeholder="ì´ë¦„" />
            <label for="floatingInput">ì´ë¦„</label>
        </div>
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="age" placeholder="ë‚˜ì´" />
            <label for="floatingInput">ë‚˜ì´</label>
        </div>
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="blogLink" placeholder="ë¸”ë¡œê·¸ ë§í¬" />
            <label for="floatingInput">ë¸”ë¡œê·¸ ë§í¬</label>
        </div>
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="hobby" placeholder="ì·¨ë¯¸" />
            <label for="floatingInput">ì·¨ë¯¸</label>
        </div>
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="intro" placeholder="í•œ ì¤„ ìê¸°ì†Œê°œ" />
            <label for="floatingInput">í•œ ì¤„ ìê¸°ì†Œê°œ</label>
        </div>
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="tmi" placeholder="TMI" />
            <label for="floatingInput">TMI</label>
        </div>
        <button id="postingbtn" type="button" class="btn btn-danger">
            íŒ€ì› ì¶”ê°€í•˜ê¸°
        </button>
    </div>

    <!-- íŒ€ì› ì¡°íšŒ -->
    <div id="profile" style="display: none">
    </div>

    <div class="guestbook-container">
        <div class="guestbook-title">ë°©ëª…ë¡</div>

        <div class="form-group">
            <label for="guestName">ì´ë¦„</label>
            <input type="text" id="guestName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>
        <div class="form-group">
            <label for="guestContent">ë°©ëª…ë¡ ë‚´ìš©</label>
            <textarea id="guestContent" rows="3" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        </div>
        <div class="btn-submit" id="guestSubmit">ë“±ë¡í•˜ê¸°</div>

        <div id="guestList" style="margin-top: 30px;"></div>

    </div>
</body>

</html>